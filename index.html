<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OCR PDF to Text</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #output { white-space: pre-wrap; background: #f0f0f0; padding: 10px; border: 1px solid #ccc; margin-top: 10px; }
    canvas { display: none; }
  </style>
</head>
<body>

<h3>📄 OCR PDF to Text (Client-side)</h3>
<input type="file" id="pdfInput" accept="application/pdf" />
<div id="status">Chưa xử lý</div>
<div id="output">Kết quả OCR sẽ hiển thị ở đây</div>

<!-- Thư viện cần thiết -->
<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.4.120/build/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.1/dist/tesseract.min.js"></script>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.4.120/build/pdf.worker.min.js';

document.getElementById('pdfInput').addEventListener('change', async function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const status = document.getElementById('status');
  const output = document.getElementById('output');
  status.innerText = '📥 Đang tải PDF...';

  const arrayBuffer = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
  const page = await pdf.getPage(1); // chỉ xử lý trang đầu tiên, có thể lặp nếu cần nhiều trang

  const viewport = page.getViewport({ scale: 2.0 });
  const canvas = document.createElement('canvas');
  const context = canvas.getContext('2d');
  canvas.width = viewport.width;
  canvas.height = viewport.height;

  await page.render({ canvasContext: context, viewport: viewport }).promise;

  status.innerText = '🔍 Đang OCR...';

  const dataUrl = canvas.toDataURL(); // chuyển canvas thành ảnh
  const result = await Tesseract.recognize(dataUrl, 'eng', {
    logger: m => console.log(m) // log tiến trình
  });

  status.innerText = '✅ Hoàn tất OCR';
  output.innerText = result.data.text;
});
</script>

</body>
</html>